# 검증 오탐 수정: 변수 뒤 텍스트 바로 붙이기 허용

## 문제 설명

번역 검증 시스템이 완전한 게임 변수 뒤에 텍스트가 바로 붙는 경우를 잘못 오류로 판단하는 문제가 있었습니다.

### 오탐 사례

```
원본: "in the 12th century"
번역: "$gold$12 세기"  ❌ 잘못된 오류: "$12를 잘못된 변수로 감지"
```

실제로는:
- `$gold$` = 완전한 변수
- `12 세기` = 일반 텍스트

하지만 시스템은 `$12`를 불완전한 변수로 감지했습니다.

### 유효한 사례들

이런 패턴들은 모두 유효합니다:
- `$gold$12 세기` - 변수 + 숫자
- `$var$abc` - 변수 + 알파벳
- `$prestige$위신` - 변수 + 한글
- `£gold£100` - 파운드 변수 + 숫자
- `@icon@text` - 앳 변수 + 텍스트
- `$gold|=+0$1234` - 포맷 지정자 + 숫자

## 근본 원인

`detectMalformedVariables()` 함수의 `dollarStart` 패턴이 겹치는 매칭을 생성:

```typescript
// 패턴: /\$[a-zA-Z0-9_\-.]+(?!\$)/g
// "$gold$12" 텍스트에서:
// - "$gol" 매칭 (부분)
// - "$12" 매칭 (닫는 $ 위치부터 시작)
```

기존 로직은 `.includes()` 문자열 검사만 수행:
- `"$gold$".includes("$gol")` → true ✓
- `"$gold$".includes("$12")` → false ❌ (오탐!)

## 해결 방법

**위치 기반 겹침 감지 구현**

1. 모든 매칭에 대해 위치 정보(start, end) 추적
2. 불완전한 패턴이 완전한 변수와 위치상 겹치는지 확인:
   - 완전한 변수 내부에 있는 경우
   - 완전한 변수의 닫는 기호에서 시작하는 경우

```typescript
// "$gold$12"에서:
// - completeVar: {match: "$gold$", start: 0, end: 6}
// - pattern: {match: "$12", start: 5, end: 8}
// - 검사: pattern.start (5) >= completeVar.end - 1 (5) ✓
// → "$12"는 "$gold$"의 닫는 $ 위치에서 시작하므로 유효함
```

## 테스트 결과

모든 테스트 통과 (17개):
- ✅ 변수 뒤 숫자/텍스트/기호 바로 붙이기
- ✅ 모든 변수 타입 ($, £, @) 지원
- ✅ 포맷 지정자 포함 변수 지원
- ✅ 여전히 실제 잘못된 패턴 감지 ($[, [$, £[, 등)
- ✅ 여전히 불완전한 변수 감지 ($gold, gold$, 등)

## 영향

이 수정으로:
- 유효한 번역이 잘못 재번역되는 문제 해결
- 게임 내에서 정상 작동하는 패턴들 허용
- 실제 위험한 패턴은 여전히 정확히 감지

## 관련 문서

- 이전 오탐 수정 (구두점): `FALSE_POSITIVE_FIX.md`
