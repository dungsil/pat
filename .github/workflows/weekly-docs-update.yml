name: Weekly Documentation Update Request

on:
  schedule:
    - cron: '0 0 * * 1' # ë§¤ì£¼ ì›”ìš”ì¼ UTC 0ì‹œ (í•œêµ­ì‹œê°„ ì˜¤ì „ 9ì‹œ)
  workflow_dispatch:

jobs:
  create-docs-update-issue:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read
    env:
      LOG_LEVEL: "${{ vars.LOG_LEVEL }}"
    steps:
      - name: Checkout repository
        uses: actions/checkout@v6
        with:
          fetch-depth: 0

      - name: Get changes from last week
        id: changes
        run: |
          # [skip ci] ì»¤ë°‹ ì œì™¸í•˜ê³  ì§€ë‚œ 7ì¼ê°„ ë³€ê²½ì‚¬í•­ ìˆ˜ì§‘
          CHANGES=$(git log --since="7 days ago" --oneline --no-merges | grep -v "\[skip ci\]" || echo "ë³€ê²½ì‚¬í•­ ì—†ìŒ")
          echo "changes<<EOF" >> $GITHUB_OUTPUT
          echo "$CHANGES" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      - name: Create documentation update issue
        uses: actions/github-script@v8
        env:
          CHANGES: ${{ steps.changes.outputs.changes }}
        with:
          script: |
            const changes = process.env.CHANGES;
            const date = new Date().toISOString().split('T')[0];
            
            const issueBody = `@copilot
            
            ì§€ë‚œ ì£¼ì˜ ë³€ê²½ì‚¬í•­ì„ ë°”íƒ•ìœ¼ë¡œ ë¬¸ì„œë¥¼ í˜„í–‰í™”í•´ì£¼ì„¸ìš”.
            
            ## ì§€ë‚œ 7ì¼ê°„ ë³€ê²½ì‚¬í•­
            
            \`\`\`
            ${changes}
            \`\`\`
            
            <!-- ì˜ˆì‹œ í˜•ì‹:
            93281a6 feat: Add weekly documentation update workflow
            07c8da3 Add translation for 'hegemony' in dictionary
            a1b2c3d fix: Update parser to handle edge cases
            -->
            
            ## ìš”ì²­ì‚¬í•­
            
            ë‹¤ìŒ ë¬¸ì„œë“¤ì„ ê²€í† í•˜ê³  í•„ìš”í•œ ê²½ìš° ì—…ë°ì´íŠ¸í•´ì£¼ì„¸ìš”:
            - README.md
            - AGENTS.md
            - docs/ í´ë” í•˜ìœ„ ë¬¸ì„œë“¤
            
            ë³€ê²½ì‚¬í•­ì´ ë¬¸ì„œì— ë°˜ì˜ë˜ì–´ì•¼ í•  ë‚´ìš©ì´ ìˆë‹¤ë©´ ì—…ë°ì´íŠ¸ë¥¼ ì§„í–‰í•´ì£¼ì„¸ìš”.`;
            
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `ğŸ“š ì£¼ê°„ ë¬¸ì„œ í˜„í–‰í™” ìš”ì²­ (${date})`,
              body: issueBody,
              labels: ['documentation', 'copilot']
            });
